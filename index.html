<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de pacientes</title>
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <h1>Registro de pacientes</h1>

    <div id="PacientesCadastrados">
        <h2>Pacientes cadastrados</h2>

        <button onclick="AbrirSecaoCadastro()">Cadastrar um novo paciente</button>
        <br><br>

        <table border="1">
            <tr>
                <th>Nome</th>
                <th>CPF</th>
                <th>Data de nascimento</th>
                <th>Telefone</th>
                <th>Profissão</th>
                <th>Bairro</th>
                <th>Valor de atendimento</th>
                <th>Forma de pagamento</th>
                <th colspan="3">Opções de configuração</th>
            </tr>
            <tbody id="TabelaPacientesCadastrados"></tbody>
        </table>
    </div>

    <div id="SecaoCadastroPacientes" class="hidden">
        <h2>Cadastro - preencha as informações do novo paciente</h2>

        <p>Nome: <input type="text" id="nomePacienteInput" placeholder="Digite o nome"></p>
        <p>CPF: <input type="text" id="cpfPacienteInput" placeholder="Digite o CPF"></p>
        <p>Data de nascimento: <input type="date" id="dataNascPacienteInput"></p>
        <p>Telefone: <input type="text" id="telefonePacienteInput" placeholder="Digite o n° de telefone"></p>
        <p>Profissão: <input type="text" id="profissaoPacienteInput" placeholder="Digite a profissão"></p>
        <p>Bairro: <input type="text" id="bairroPacienteInput" placeholder="Digite o bairro de moradia"></p>
        <p>Valor do atendimento: <input type="number" id="valorAtendPacienteInput"
                placeholder="Digite o valor de atendimento"></p>
        <p>Forma de pagamento: <input type="text" id="formaPagamentoPacienteInput"
                placeholder="Digite a forma de pagamento"></p>
        <br>

        <button onclick="CadastrarPaciente()">Salvar</button>
        <button onclick="FecharSecaoCadastro()">Cancelar</button>
    </div>

    <script>
        const divPacientesCadastrados = document.getElementById("PacientesCadastrados")
        const divCadastroPacientes = document.getElementById("SecaoCadastroPacientes")

        function AbrirSecaoCadastro() {
            divCadastroPacientes.classList.remove("hidden")
            divPacientesCadastrados.classList.add("hidden")
        }
        function FecharSecaoCadastro() {
            nomePaciente.value = ""
            cpfPaciente.value = ""
            dataNascPaciente.value = ""
            telefonePaciente.value = ""
            profissaoPaciente.value = ""
            bairroPaciente.value = ""
            valorAtendPaciente.value = ""
            formaPagamentoPaciente.value = ""

            divCadastroPacientes.classList.add("hidden")
            divPacientesCadastrados.classList.remove("hidden")
        }

        const nomePaciente = document.getElementById("nomePacienteInput")
        const cpfPaciente = document.getElementById("cpfPacienteInput")
        const dataNascPaciente = document.getElementById("dataNascPacienteInput")
        const telefonePaciente = document.getElementById("telefonePacienteInput")
        const profissaoPaciente = document.getElementById("profissaoPacienteInput")
        const bairroPaciente = document.getElementById("bairroPacienteInput")
        const valorAtendPaciente = document.getElementById("valorAtendPacienteInput")
        const formaPagamentoPaciente = document.getElementById("formaPagamentoPacienteInput")

        let pacientes = JSON.parse(localStorage.getItem("pacientes")) || []

        function CadastrarPaciente() {
            let paciente = {
                nome: nomePaciente.value.trim(),
                cpf: cpfPaciente.value.trim(),
                data_nascimento: dataNascPaciente.value.trim(),
                telefone: telefonePaciente.value.trim(),
                profissao: profissaoPaciente.value.trim(),
                bairro: bairroPaciente.value.trim(),
                valor_atendimento: valorAtendPaciente.value.trim(),
                forma_pagamento: formaPagamentoPaciente.value.trim()
            }

            pacientes.push(paciente)
            console.log(pacientes)

            localStorage.setItem("pacientes", JSON.stringify(pacientes))

            FecharSecaoCadastro()
            AtualizarTabela()
        }


        const TabelaPacientesCadastrados = document.getElementById("TabelaPacientesCadastrados")

        window.onload = function () {
            AtualizarTabela()
        }

        function AtualizarTabela() {
            TabelaPacientesCadastrados.innerHTML = ""

            for (let i = 0; i < pacientes.length; i++) {
                const linha = document.createElement("tr")
                linha.innerHTML = `
                <th>${pacientes[i].nome.trim()}</th>
                <th>${pacientes[i].cpf.trim()}</th>
                <th>${pacientes[i].data_nascimento.trim()}</th>
                <th>${pacientes[i].telefone.trim()}</th>
                <th>${pacientes[i].profissao.trim()}</th>
                <th>${pacientes[i].bairro.trim()}</th>
                <th>${pacientes[i].valor_atendimento.trim()}</th>
                <th>${pacientes[i].forma_pagamento.trim()}</th>
                <th><button onclick="ExcluirPaciente(${i})">Exluir</button></th>
                <th><button>Editar</button></th>
                <th><button>Histórico de atendimento</button></th>
            `
                TabelaPacientesCadastrados.appendChild(linha)
            }
        }

        function ExcluirPaciente(indice) {
            const confirmar = confirm("Deseja mesmo excluir esse paciente?")

            if(confirmar){
                pacientes.splice(indice, 1) // remove do array
            localStorage.setItem("pacientes", JSON.stringify(pacientes)) // remove do localstorage

            AtualizarTabela()
            }
        }

    </script>


</body>

</html>